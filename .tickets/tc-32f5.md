---
id: tc-32f5
status: closed
deps: []
links: []
created: 2026-01-09T13:48:16Z
type: task
priority: 2
assignee: Ray Myers
---
# Spec review vs python implementation

Inspect python implementation vs docs/SPEC.md.

Is it complete? Does it match?

Save your notes in docs/SPEC_REVIEW_PYTHON.md.

## Notes

**2026-01-09T13:51:08Z**

Starting spec review: comparing docs/SPEC.md with python/ticket/src/ticket/cli.py implementation

**2026-01-09T13:52:15Z**

Found 2 main discrepancies:

1. MISSING COMMAND: migrate-beads
   - Specified in SPEC.md (lines 230-244)
   - Not implemented in Python cli.py
   - No BDD tests for it

2. INCORRECT SORTING: dep tree children not sorted by subtree depth
   - Spec says (line 105): 'Sort children by subtree depth (shallowest first), then by ID (ascending)'
   - Python implementation (lines 988-991) just iterates deps in array order without sorting
   - Verified with test: root depends on [b, c] where b has deeper tree (b->d->e) and c is leaf
   - Python shows: b then c (wrong - deeper first)
   - Should show: c then b (correct - shallower first)

Other observations:
- All 40 BDD scenarios pass (but don't test sorting order or migrate-beads)
- Cycle detection uses set instead of path string (:id1:id2:) - functionally equivalent, O(1) vs O(n)
- All other commands implemented correctly

**2026-01-09T13:53:12Z**

Confirmed with testing:

Bash reference implementation (ticket script):
- ✓ Implements dep tree sorting correctly (lines 405-415)
- ✓ Implements migrate-beads command (lines 1127+)
- Test: bash shows 'c' before 'b' (correct - shallowest first)

Python implementation (python/ticket/src/ticket/cli.py):
- ✗ Does NOT sort dep tree children by subtree depth
- ✗ Does NOT implement migrate-beads command  
- Test: Python shows 'b' before 'c' (incorrect - just array order)

Conclusion: Python implementation is incomplete compared to spec and bash reference.

**2026-01-09T13:53:27Z**

SPEC REVIEW SUMMARY

Methodology:
- Compared docs/SPEC.md with python/ticket/src/ticket/cli.py
- Ran all BDD tests (40 scenarios - all pass)
- Created test cases for sorting behavior
- Compared with bash reference implementation

KEY FINDINGS:

1. MISSING COMMAND: migrate-beads
   Location: SPEC.md lines 230-244
   Status: Implemented in bash (line 1127), NOT in Python
   Impact: Users cannot migrate from .beads format using Python version

2. INCORRECT SORTING: dep tree children
   Spec requirement: 'Sort children by subtree depth (shallowest first), then by ID'
   Bash: Correctly implements sorting (lines 405-415 in ticket script)
   Python: Just iterates deps array without sorting (lines 988-991 in cli.py)
   Test evidence:
   - Setup: root→[b,c], b→d→e, c is leaf
   - Expected: c (depth 1), then b (depth 3)
   - Bash output: c then b ✓
   - Python output: b then c ✗

MINOR OBSERVATIONS:
- Cycle detection: Python uses set (O(1)), spec suggests string ':id:id:' (O(n)) - both work, set is better
- All 18 other commands- All 18 otimplemented
- All error messages match spec
- YAML operations m- YAML operations m- YAML operations m- YAMLsu- YAML operations m- YAML operations m- MMENDATION:
Python implementation needs:
1. Add migrate-beads command
2. Implement subtree depth calculation and sorting in dep tree
